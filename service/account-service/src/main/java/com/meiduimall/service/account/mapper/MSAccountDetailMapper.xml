<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<!-- 余额变动明细表ms_account_detail相关操作 -->
<mapper namespace="MSAccountDetailMapper" >

 <resultMap id="BaseResultMap" type="com.meiduimall.service.account.model.MSAccountDetail" >
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="account_id" property="accountId" jdbcType="VARCHAR" />
    <result column="account_type" property="accountType" jdbcType="VARCHAR" />
    <result column="mem_id" property="memId" jdbcType="VARCHAR" />
    <result column="trade_type" property="tradeType" jdbcType="VARCHAR" />
    <result column="trade_amount" property="tradeAmount" jdbcType="VARCHAR" />
    <result column="trade_date" property="tradeDate" jdbcType="TIMESTAMP" />
    <result column="in_or_out" property="inOrOut" jdbcType="INTEGER" />
    <result column="balance" property="balance" jdbcType="VARCHAR" />
    <result column="business_no" property="businessNo" jdbcType="VARCHAR" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
    <result column="curr_time" property="currTime" jdbcType="DECIMAL" />
  </resultMap>
  
  	<!-- 插入余额变动明细记录 -->
	<insert id="insertAccountDetail" parameterType="java.util.Map">
		INSERT INTO ms_account_detail
		VALUES(
			#{id},
			#{accountId},
			#{accountType},
			#{memId},
			#{tradeType},
			#{tradeAmount},
			#{tradeDate},
			#{inOrOut},
			#{balance},
			#{orderId},
			#{remark},
			now(),
			unix_timestamp()
			)
	</insert>
	
	  <sql id="Base_Column_List" >
    id, account_id, account_type, mem_id, trade_type, trade_amount, trade_date, in_or_out, 
    balance, business_no, remark, create_date, curr_time
  </sql>
  <select id="listMSAccountDetail" resultMap="BaseResultMap" parameterType="com.meiduimall.service.account.model.MSAccountDetailGet" >
    select 
    <include refid="Base_Column_List" />
    from ms_account_detail m
    where 1 = 1
     <if test="accountId !=null and accountId !=''">
         	and m.account_id = #{accountId}
     </if> 
     <if test="accountType !=null and accountType !=''">
         	and m.account_type = #{accountType}
     </if> 
     <if test="memId !=null and memId !=''">
         	and m.mem_id = #{memId}
     </if> 
     <if test="tradeType !=null and tradeType !=''">
	        and m.trade_type in
	          <foreach item="id" index="index" collection="tradeTypeList" open="(" separator="," close=")">  
				  #{id}  
		  	  </foreach>
     </if>
  </select>
	
	<select id="listMSAccountCondition" resultMap="BaseResultMap" parameterType="com.meiduimall.service.account.model.MSAccountDetailCondition" >
    select 
    a.*,m.mem_login_name as loginName,m.mem_phone as phone,md.dict_value as bizType
    from ms_account_detail a, ms_members m ,ms_dict md where a.mem_id=m.mem_id and md.dict_id=a.trade_type
    
    <if test="memLoginName !=null and memLoginName !=''">
         	and m.mem_login_name = #{memLoginName}
     </if> 
     <if test="memPhone !=null and memPhone !=''">
         	and m.mem_phone = #{memPhone}
     </if> 
    <if test="tradeType !=null and tradeType !=''">
         	and a.trade_type = #{tradeType}
     </if> 
     <if test="beginDate !=null and beginDate !=''">
         	and a.create_date >= #{beginDate} 
     </if> 
      <if test="endDate !=null and endDate !=''">
         	and a.create_date >= #{beginDate} and #{endDate} >=a.create_date 
     </if>
  </select>
  
</mapper>